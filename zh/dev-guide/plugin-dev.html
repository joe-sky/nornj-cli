<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件开发指南 | NornJ CLI</title>
    <meta name="description" content="🛠️ 一套可配置化、易于扩展的脚手架工具">
    <link rel="icon" href="/nornj-cli/favicon.png">
  <link rel="manifest" href="/nornj-cli/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/nornj-cli/icons/apple-touch-icon-152x152.png">
  <link rel="mask-icon" href="/nornj-cli/icons/safari-pinned-tab.svg" color="#3eaf7c">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/nornj-cli/assets/css/0.styles.f1bfe761.css" as="style"><link rel="preload" href="/nornj-cli/assets/js/app.261fa4a4.js" as="script"><link rel="preload" href="/nornj-cli/assets/js/3.bc847c09.js" as="script"><link rel="preload" href="/nornj-cli/assets/js/51.9d6f247f.js" as="script"><link rel="prefetch" href="/nornj-cli/assets/js/10.71560345.js"><link rel="prefetch" href="/nornj-cli/assets/js/11.0b95383d.js"><link rel="prefetch" href="/nornj-cli/assets/js/12.df985099.js"><link rel="prefetch" href="/nornj-cli/assets/js/13.430cdf18.js"><link rel="prefetch" href="/nornj-cli/assets/js/14.c6a216b4.js"><link rel="prefetch" href="/nornj-cli/assets/js/15.6336aba1.js"><link rel="prefetch" href="/nornj-cli/assets/js/16.b9c9eed8.js"><link rel="prefetch" href="/nornj-cli/assets/js/17.f1857aac.js"><link rel="prefetch" href="/nornj-cli/assets/js/18.5d12849b.js"><link rel="prefetch" href="/nornj-cli/assets/js/19.a2ed0afb.js"><link rel="prefetch" href="/nornj-cli/assets/js/20.3cd1f9b8.js"><link rel="prefetch" href="/nornj-cli/assets/js/21.d4ec2cde.js"><link rel="prefetch" href="/nornj-cli/assets/js/22.fb94c59a.js"><link rel="prefetch" href="/nornj-cli/assets/js/23.510d0506.js"><link rel="prefetch" href="/nornj-cli/assets/js/24.bb3e705c.js"><link rel="prefetch" href="/nornj-cli/assets/js/25.2f0883d4.js"><link rel="prefetch" href="/nornj-cli/assets/js/26.cc95afe5.js"><link rel="prefetch" href="/nornj-cli/assets/js/27.2b4cf4d0.js"><link rel="prefetch" href="/nornj-cli/assets/js/28.0677e297.js"><link rel="prefetch" href="/nornj-cli/assets/js/29.7be9099e.js"><link rel="prefetch" href="/nornj-cli/assets/js/30.b61b8509.js"><link rel="prefetch" href="/nornj-cli/assets/js/31.3678a010.js"><link rel="prefetch" href="/nornj-cli/assets/js/32.a7cd9e25.js"><link rel="prefetch" href="/nornj-cli/assets/js/33.bc2e2cf5.js"><link rel="prefetch" href="/nornj-cli/assets/js/34.256ebe73.js"><link rel="prefetch" href="/nornj-cli/assets/js/35.e0a1c1a8.js"><link rel="prefetch" href="/nornj-cli/assets/js/36.56fdf07f.js"><link rel="prefetch" href="/nornj-cli/assets/js/37.203d8c17.js"><link rel="prefetch" href="/nornj-cli/assets/js/38.ad005fb0.js"><link rel="prefetch" href="/nornj-cli/assets/js/39.4991a369.js"><link rel="prefetch" href="/nornj-cli/assets/js/4.b3425f3c.js"><link rel="prefetch" href="/nornj-cli/assets/js/40.e7f84947.js"><link rel="prefetch" href="/nornj-cli/assets/js/41.0bb8da68.js"><link rel="prefetch" href="/nornj-cli/assets/js/42.a8d54bd0.js"><link rel="prefetch" href="/nornj-cli/assets/js/43.81ec9ade.js"><link rel="prefetch" href="/nornj-cli/assets/js/44.6087ec7c.js"><link rel="prefetch" href="/nornj-cli/assets/js/45.398edd74.js"><link rel="prefetch" href="/nornj-cli/assets/js/46.16d2db5d.js"><link rel="prefetch" href="/nornj-cli/assets/js/47.2272003f.js"><link rel="prefetch" href="/nornj-cli/assets/js/48.ac7336ae.js"><link rel="prefetch" href="/nornj-cli/assets/js/49.f9a296c9.js"><link rel="prefetch" href="/nornj-cli/assets/js/5.a1c47062.js"><link rel="prefetch" href="/nornj-cli/assets/js/50.c22cefbe.js"><link rel="prefetch" href="/nornj-cli/assets/js/52.81bc0e56.js"><link rel="prefetch" href="/nornj-cli/assets/js/53.d38df6d7.js"><link rel="prefetch" href="/nornj-cli/assets/js/54.944047c2.js"><link rel="prefetch" href="/nornj-cli/assets/js/55.7ad50c4a.js"><link rel="prefetch" href="/nornj-cli/assets/js/56.2715648f.js"><link rel="prefetch" href="/nornj-cli/assets/js/57.a91747e2.js"><link rel="prefetch" href="/nornj-cli/assets/js/58.7613de44.js"><link rel="prefetch" href="/nornj-cli/assets/js/59.106fb976.js"><link rel="prefetch" href="/nornj-cli/assets/js/6.9275d20c.js"><link rel="prefetch" href="/nornj-cli/assets/js/60.04a83941.js"><link rel="prefetch" href="/nornj-cli/assets/js/61.187d092f.js"><link rel="prefetch" href="/nornj-cli/assets/js/62.3e07a9e7.js"><link rel="prefetch" href="/nornj-cli/assets/js/63.c64152ae.js"><link rel="prefetch" href="/nornj-cli/assets/js/64.402b88dd.js"><link rel="prefetch" href="/nornj-cli/assets/js/65.c9a7394b.js"><link rel="prefetch" href="/nornj-cli/assets/js/66.34099aad.js"><link rel="prefetch" href="/nornj-cli/assets/js/67.7ad0e778.js"><link rel="prefetch" href="/nornj-cli/assets/js/68.acf93dfe.js"><link rel="prefetch" href="/nornj-cli/assets/js/69.0cc0ff29.js"><link rel="prefetch" href="/nornj-cli/assets/js/7.4eafd19b.js"><link rel="prefetch" href="/nornj-cli/assets/js/70.28a141d8.js"><link rel="prefetch" href="/nornj-cli/assets/js/71.ec4a6399.js"><link rel="prefetch" href="/nornj-cli/assets/js/72.e63aa437.js"><link rel="prefetch" href="/nornj-cli/assets/js/73.21ebb547.js"><link rel="prefetch" href="/nornj-cli/assets/js/8.e0b21abc.js"><link rel="prefetch" href="/nornj-cli/assets/js/9.1ff32274.js"><link rel="prefetch" href="/nornj-cli/assets/js/vendors~docsearch.192c4e2d.js">
    <link rel="stylesheet" href="/nornj-cli/assets/css/0.styles.f1bfe761.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/nornj-cli/zh/" class="home-link router-link-active"><!----> <span class="site-name">NornJ CLI</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/nornj-cli/zh/guide/installation.html" class="nav-link">指南</a></div><div class="nav-item"><a href="/nornj-cli/zh/config/" class="nav-link">配置参考</a></div><div class="nav-item"><a href="/nornj-cli/zh/dev-guide/" class="nav-link router-link-active">扩展开发指南</a></div><div class="nav-item"><a href="https://github.com/joe-sky/nornj-cli/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nornj-cli/dev-guide/plugin-dev.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/nornj-cli/zh/dev-guide/plugin-dev.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/joe-sky/nornj-cli" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/nornj-cli/zh/guide/installation.html" class="nav-link">指南</a></div><div class="nav-item"><a href="/nornj-cli/zh/config/" class="nav-link">配置参考</a></div><div class="nav-item"><a href="/nornj-cli/zh/dev-guide/" class="nav-link router-link-active">扩展开发指南</a></div><div class="nav-item"><a href="https://github.com/joe-sky/nornj-cli/blob/master/CHANGELOG.md" target="_blank" rel="noopener noreferrer" class="nav-link external">
  更新记录
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/nornj-cli/dev-guide/plugin-dev.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/nornj-cli/zh/dev-guide/plugin-dev.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/joe-sky/nornj-cli" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/nornj-cli/zh/dev-guide/plugin-dev.html" class="active sidebar-link">插件开发指南</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#核心概念" class="sidebar-link">核心概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#creator" class="sidebar-link">Creator</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#service" class="sidebar-link">Service</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#cli-插件" class="sidebar-link">CLI 插件</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#service-插件" class="sidebar-link">Service 插件</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#generator" class="sidebar-link">Generator</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#prompts" class="sidebar-link">Prompts</a></li></ul></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#发布插件" class="sidebar-link">发布插件</a></li><li class="sidebar-sub-header"><a href="/nornj-cli/zh/dev-guide/plugin-dev.html#开发核心插件的注意事项" class="sidebar-link">开发核心插件的注意事项</a></li></ul></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>UI 开发</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/nornj-cli/zh/dev-guide/ui-info.html" class="sidebar-link">UI 插件信息</a></li><li><a href="/nornj-cli/zh/dev-guide/ui-api.html" class="sidebar-link">UI 插件 API</a></li><li><a href="/nornj-cli/zh/dev-guide/ui-localization.html" class="sidebar-link">UI 本地化</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="插件开发指南"><a href="#插件开发指南" aria-hidden="true" class="header-anchor">#</a> 插件开发指南</h1> <h2 id="核心概念"><a href="#核心概念" aria-hidden="true" class="header-anchor">#</a> 核心概念</h2> <p>系统里有两个主要的部分：</p> <ul><li><code>@vue/cli</code>：全局安装的，暴露 <code>vue create &lt;app&gt;</code> 命令；</li> <li><code>@vue/cli-service</code>：局部安装，暴露 <code>vue-cli-service</code> 命令。</li></ul> <p>两者皆应用了基于插件的架构。</p> <h3 id="creator"><a href="#creator" aria-hidden="true" class="header-anchor">#</a> Creator</h3> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/Creator.js" target="_blank" rel="noopener noreferrer">Creator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是调用 <code>vue create &lt;app&gt;</code> 时创建的类。负责偏好对话、调用 generator 和安装依赖。</p> <h3 id="service"><a href="#service" aria-hidden="true" class="header-anchor">#</a> Service</h3> <p><a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/Service.js" target="_blank" rel="noopener noreferrer">Service<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是调用 <code>vue-cli-service &lt;command&gt; [...args]</code> 时创建的类。负责管理内部的 webpack 配置、暴露服务和构建项目的命令等。</p> <h3 id="cli-插件"><a href="#cli-插件" aria-hidden="true" class="header-anchor">#</a> CLI 插件</h3> <p>CLI 插件是一个可以为 <code>@vue/cli</code> 项目添加额外特性的 npm 包。它应该始终包含一个 <a href="#service-%E6%8F%92%E4%BB%B6">Service 插件</a>作为其主要导出，且可选的包含一个 <a href="#generator">Generator</a> 和一个 <a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D">Prompt 文件</a>。</p> <p>一个典型的 CLI 插件的目录结构看起来是这样的：</p> <div class="language- extra-class"><pre class="language-text"><code>.
├── README.md
├── generator.js  # generator (可选)
├── prompts.js    # prompt 文件 (可选)
├── index.js      # service 插件
└── package.json
</code></pre></div><h3 id="service-插件"><a href="#service-插件" aria-hidden="true" class="header-anchor">#</a> Service 插件</h3> <p>Service 插件会在一个 Service 实例被创建时自动加载——比如每次 <code>vue-cli-service</code> 命令在项目中被调用时。</p> <p>注意我们这里讨论的“service 插件”的概念要比发布为一个 npm 包的“CLI 插件”的要更窄。前者涉及一个会被 <code>@vue/cli-service</code> 在初始化时加载的模块，也经常是后者的一部分。</p> <p>此外，<code>@vue/cli-service</code> 的<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/commands" target="_blank" rel="noopener noreferrer">内建命令<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/config" target="_blank" rel="noopener noreferrer">配置模块<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>也是全部以 service 插件实现的。</p> <p>一个 service 插件应该导出一个函数，这个函数接受两个参数：</p> <ul><li><p>一个 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli-service/lib/PluginAPI.js" target="_blank" rel="noopener noreferrer">PluginAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实例</p></li> <li><p>一个包含 <code>vue.config.js</code> 内指定的项目本地选项的对象，或者在 <code>package.json</code> 内的 <code>vue</code> 字段。</p></li></ul> <p>这个 API 允许 service 插件针对不同的环境扩展/修改内部的 webpack 配置，并向 <code>vue-cli-service</code> 注入额外的命令。例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> projectOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 通过 webpack-chain 修改 webpack 配置</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  api<span class="token punctuation">.</span><span class="token function">configureWebpack</span><span class="token punctuation">(</span><span class="token parameter">webpackConfig</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 修改 webpack 配置</span>
    <span class="token comment">// 或返回通过 webpack-merge 合并的配置对象</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 注册 `vue-cli-service test`</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="为命令指定模式"><a href="#为命令指定模式" aria-hidden="true" class="header-anchor">#</a> 为命令指定模式</h4> <blockquote><p>注意：插件设置模式的方式从 beta.10 开始已经改变了。</p></blockquote> <p>如果一个已注册的插件命令需要运行在特定的默认模式下，则该插件需要通过 <code>module.exports.defaultModes</code> 以 <code>{ [commandName]: mode }</code> 的形式来暴露：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'build'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>defaultModes <span class="token operator">=</span> <span class="token punctuation">{</span>
  build<span class="token punctuation">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这是因为我们需要在加载环境变量之前知道该命令的预期模式，所以需要提前加载用户选项/应用插件。</p> <h4 id="在插件中解析-webpack-配置"><a href="#在插件中解析-webpack-配置" aria-hidden="true" class="header-anchor">#</a> 在插件中解析 webpack 配置</h4> <p>一个插件可以通过调用 <code>api.resolveWebpackConfig()</code> 取回解析好的 webpack 配置。每次调用都会新生成一个 webpack 配置用来在需要时进一步修改。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'my-build'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> configA <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> configB <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 针对不同的目的修改 `configA` 和 `configB`...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 请确保为正确的环境变量指定默认模式</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>defaultModes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">'my-build'</span><span class="token punctuation">:</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>或者，一个插件也可以通过调用 <code>api.resolveChainableWebpackConfig()</code> 获得一个新生成的<a href="https://github.com/mozilla-neutrino/webpack-chain" target="_blank" rel="noopener noreferrer">链式配置<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="language-js extra-class"><pre class="language-js"><code>api<span class="token punctuation">.</span><span class="token function">registerCommand</span><span class="token punctuation">(</span><span class="token string">'my-build'</span><span class="token punctuation">,</span> <span class="token parameter">args</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> configA <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveChainableWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> configB <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">resolveChainableWebpackConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 针对不同的目的链式修改 `configA` 和 `configB`...</span>

  <span class="token keyword">const</span> finalConfigA <span class="token operator">=</span> configA<span class="token punctuation">.</span><span class="token function">toConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> finalConfigB <span class="token operator">=</span> configB<span class="token punctuation">.</span><span class="token function">toConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="第三方插件的自定义选项"><a href="#第三方插件的自定义选项" aria-hidden="true" class="header-anchor">#</a> 第三方插件的自定义选项</h4> <p><code>vue.config.js</code> 的导出将会<a href="https://github.com/vuejs/vue-cli/blob/dev/packages/%40vue/cli-service/lib/options.js#L3" target="_blank" rel="noopener noreferrer">通过一个 schema 的验证<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>以避免笔误和错误的配置值。然而，一个第三方插件仍然允许用户通过 <code>pluginOptions</code> 字段配置其行为。例如，对于下面的 <code>vue.config.js</code>：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  pluginOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    foo<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>该第三方插件可以读取 <code>projectOptions.pluginOptions.foo</code> 来做条件式的决定配置。</p> <h3 id="generator"><a href="#generator" aria-hidden="true" class="header-anchor">#</a> Generator</h3> <p>一个发布为 npm 包的 CLI 插件可以包含一个 <code>generator.js</code> 或 <code>generator/index.js</code> 文件。插件内的 generator 将会在两种场景下被调用：</p> <ul><li><p>在一个项目的初始化创建过程中，如果 CLI 插件作为项目创建 preset 的一部分被安装。</p></li> <li><p>插件在项目创建好之后通过 <code>vue invoke</code> 独立调用时被安装。</p></li></ul> <p>这里的 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/GeneratorAPI.js" target="_blank" rel="noopener noreferrer">GeneratorAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 允许一个 generator 向 <code>package.json</code> 注入额外的依赖或字段，并向项目中添加文件。</p> <p>一个 generator 应该导出一个函数，这个函数接收三个参数：</p> <ol><li><p>一个 <code>GeneratorAPI</code> 实例：</p></li> <li><p>这个插件的 generator 选项。这些选项会在项目创建对话过程中被解析，或从一个保存在 <code>~/.vuerc</code> 中的 preset 中加载。例如，如果保存好的 <code>~/.vuerc</code> 像如下的这样：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;@vue/cli-plugin-foo&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;option&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bar&quot;</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果用户使用 preset <code>foo</code> 创建了一个项目，那么 <code>@vue/cli-plugin-foo</code> 的 generator 就会收到 <code>{ option: 'bar' }</code> 作为第二个参数。</p> <p>对于一个第三方插件来说，该选项将会解析自对话或用户执行 <code>vue invoke</code> 时的命令行参数中 (详见<a href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E6%8F%92%E4%BB%B6%E7%9A%84%E5%AF%B9%E8%AF%9D">第三方插件的对话</a>)。</p></li> <li><p>整个 preset (<code>presets.foo</code>) 将会作为第三个参数传入。</p></li></ol> <p><strong>示例：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">api<span class="token punctuation">,</span> options<span class="token punctuation">,</span> rootOptions</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 修改 `package.json` 里的字段</span>
  api<span class="token punctuation">.</span><span class="token function">extendPackage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    scripts<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span> <span class="token string">'vue-cli-service test'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 复制并用 ejs 渲染 `./template` 内所有的文件</span>
  api<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'./template'</span><span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 有条件地生成文件</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="generator-的模板处理"><a href="#generator-的模板处理" aria-hidden="true" class="header-anchor">#</a> Generator 的模板处理</h4> <p>当你调用 <code>api.render('./template')</code> 时，该 generator 将会使用 <a href="https://github.com/mde/ejs" target="_blank" rel="noopener noreferrer">EJS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 渲染 <code>./template</code> 中的文件 (相对于 generator 中的文件路径进行解析)</p> <p>此外，你可以使用 YAML 前置元信息继承并替换已有的模板文件的一部分：</p> <div class="language-ejs extra-class"><pre class="language-ejs"><code>---
extend: '@vue/cli-service/generator/template/src/App.vue'
replace: !!js/regexp /<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">&lt;</span>\<span class="token regex">/script&gt;/</span>
<span class="token operator">--</span><span class="token operator">-</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 替换默认脚本</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>你也可以完成多处替换，当然你需要将要替换的字符串用 <code>&lt;%# REPLACE %&gt;</code> 和 <code>&lt;%# END_REPLACE %&gt;</code> 块包裹起来：</p> <div class="language-ejs extra-class"><pre class="language-ejs"><code>---
extend: '@vue/cli-service/generator/template/src/App.vue'
replace:
  - !!js/regexp /欢迎来到你的 Vue\.js 应用/
  - !!js/regexp /<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"><span class="token punctuation">[</span><span class="token operator">^</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token operator">?</span><span class="token operator">&lt;</span>\<span class="token regex">/script&gt;/</span>
<span class="token operator">--</span><span class="token operator">-</span>

<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
替换欢迎信息
<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># END_REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>

<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 替换默认脚本</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token comment"># END_REPLACE </span><span class="token delimiter punctuation">%&gt;</span></span>
</code></pre></div><h4 id="文件名的极端情况"><a href="#文件名的极端情况" aria-hidden="true" class="header-anchor">#</a> 文件名的极端情况</h4> <p>如果你想要渲染一个以点开头的模板文件 (例如 <code>.env</code>)，则需要遵循一个特殊的命名约定，因为以点开头的文件会在插件发布到 npm 的时候被忽略：</p> <div class="language- extra-class"><pre class="language-text"><code># 以点开头的模板需要使用下划线取代那个点：

/generator/template/_env

# 调用 api.render('./template') 会在项目目录中渲染成为：

.env
</code></pre></div><p>同时这也意味着当你想渲染以下划线开头的文件时，同样需要遵循一个特殊的命名约定：</p> <div class="language- extra-class"><pre class="language-text"><code># 这种模板需要使用两个下划线来取代单个下划线：

/generator/template/__variables.scss

# 调用 api.render('./template') 会在项目目录中渲染成为：

_variables.scss
</code></pre></div><h3 id="prompts"><a href="#prompts" aria-hidden="true" class="header-anchor">#</a> Prompts</h3> <h4 id="内建插件的对话"><a href="#内建插件的对话" aria-hidden="true" class="header-anchor">#</a> 内建插件的对话</h4> <p>只有内建插件可以定制创建新项目时的初始化对话，且这些对话模块放置在 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/promptModules" target="_blank" rel="noopener noreferrer"><code>@vue/cli</code> 包的内部<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>一个对话模块应该导出一个函数，这个函数接收一个 <a href="https://github.com/vuejs/vue-cli/tree/dev/packages/@vue/cli/lib/PromptModuleAPI.js" target="_blank" rel="noopener noreferrer">PromptModuleAPI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 实例。这些对话的底层使用 <a href="https://github.com/SBoudrias/Inquirer.js" target="_blank" rel="noopener noreferrer">inquirer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行展示：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">api</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 一个特性对象应该是一个有效的 inquirer 选择对象</span>
  api<span class="token punctuation">.</span><span class="token function">injectFeature</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Some great feature'</span><span class="token punctuation">,</span>
    value<span class="token punctuation">:</span> <span class="token string">'my-feature'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// injectPrompt 期望接收一个有效的 inquirer 对话对象</span>
  api<span class="token punctuation">.</span><span class="token function">injectPrompt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'someFlag'</span><span class="token punctuation">,</span>
    <span class="token comment">// 确认对话只在用户已经选取了特性的时候展示</span>
    <span class="token function-variable function">when</span><span class="token punctuation">:</span> <span class="token parameter">answers</span> <span class="token operator">=&gt;</span> answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">include</span><span class="token punctuation">(</span><span class="token string">'my-feature'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    message<span class="token punctuation">:</span> <span class="token string">'Do you want to turn on flag foo?'</span><span class="token punctuation">,</span>
    type<span class="token punctuation">:</span> <span class="token string">'confirm'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 当所有的对话都完成之后，将你的插件注入到</span>
  <span class="token comment">// 即将传递给 Generator 的 options 中</span>
  api<span class="token punctuation">.</span><span class="token function">onPromptComplete</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">answers<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>answers<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'my-feature'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      options<span class="token punctuation">.</span>plugins<span class="token punctuation">[</span><span class="token string">'vue-cli-plugin-my-feature'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        someFlag<span class="token punctuation">:</span> answers<span class="token punctuation">.</span>someFlag
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="第三方插件的对话"><a href="#第三方插件的对话" aria-hidden="true" class="header-anchor">#</a> 第三方插件的对话</h4> <p>第三方插件通常会在一个项目创建完毕后被手动安装，且用户将会通过调用 <code>vue invoke</code> 来初始化这个插件。如果这个插件在其根目录包含一个 <code>prompts.js</code>，那么它将会用在该插件被初始化调用的时候。这个文件应该导出一个用于 Inquirer.js 的<a href="https://github.com/SBoudrias/Inquirer.js#question" target="_blank" rel="noopener noreferrer">问题<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的数组。这些被解析的答案对象会作为选项被传递给插件的 generator。</p> <p>或者，用户可以通过在命令行传递选项来跳过对话直接初始化插件，比如：</p> <div class="language-bash extra-class"><pre class="language-bash"><code>vue invoke my-plugin --mode awesome
</code></pre></div><h2 id="发布插件"><a href="#发布插件" aria-hidden="true" class="header-anchor">#</a> 发布插件</h2> <p>为了让一个 CLI 插件能够被其它开发者使用，你必须遵循 <code>vue-cli-plugin-&lt;name&gt;</code> 的命名约定将其发布到 npm 上。插件遵循命名约定之后就可以：</p> <ul><li>被 <code>@vue/cli-service</code> 发现；</li> <li>被其它开发者搜索到；</li> <li>通过 <code>vue add &lt;name&gt;</code> 或 <code>vue invoke &lt;name&gt;</code> 安装下来。</li></ul> <h2 id="开发核心插件的注意事项"><a href="#开发核心插件的注意事项" aria-hidden="true" class="header-anchor">#</a> 开发核心插件的注意事项</h2> <div class="tip custom-block"><p class="custom-block-title">注意</p> <p>这个章节只用于 <code>vuejs/vue-cli</code> 仓库内部的内建插件工作。</p></div> <p>一个带有为本仓库注入额外依赖的 generator 的插件 (比如 <code>chai</code> 会通过 <code>@vue/cli-plugin-unit-mocha/generator/index.js</code> 被注入) 应该将这些依赖列入其自身的 <code>devDependencies</code> 字段。这会确保：</p> <ol><li><p>这个包始终存在于该仓库的根 <code>node_modules</code> 中，因此我们不必在每次测试的时候重新安装它们。</p></li> <li><p><code>yarn.lock</code> 会保持其一致性，因此 CI 程序可以更好地利用缓存。</p></li></ol></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/joe-sky/nornj-cli/edit/master/docs/zh/dev-guide/plugin-dev.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次编辑时间: </span> <span class="time">2019-6-24 19:53:13</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/nornj-cli/zh/dev-guide/ui-info.html">
          UI 插件信息
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/nornj-cli/assets/js/app.261fa4a4.js" defer></script><script src="/nornj-cli/assets/js/3.bc847c09.js" defer></script><script src="/nornj-cli/assets/js/51.9d6f247f.js" defer></script>
  </body>
</html>
